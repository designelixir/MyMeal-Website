<script>
	var allCoordinates = []
	var allContent = []
	
</script>

<p style="margin-bottom: 25px;">Menus with a "Verified MyMeal Partner" <img src="../assets/verified-mymeal.png" class="hover" onclick="verifiedPopUp(true)" style="height: 25px; margin-bottom: -10px;" alt="mymeal verified badge"/> badge have worked with us personally to provide the most accurate information possible to make your dining experience safe. Click the badge for more information on what qualifies a restaurant as a MyMeal partner.<p>

<div class="directory box-shadow">

<div id="directory-map-container">
	<div id="map"></div>
	<div class="directory-filter box-shadow">
		<div class="flex-center-start flex-wrap">
			<p class="white-text">Filter by: </p>
			<div class="category-filter hover" id="reset-categories" style="display: none;">
				<p onclick="reset()">Show All</p>
			</div>
			<div class="category-filter hover flex-center-center" onclick="categorize('mymeal-verified')" id="mymeal-verified" >
				<img src="../assets/verified-mymeal.png" style="height: 15px; margin-bottom: -2px;"/>
				<p> Verified </p>
			</div>
			{.section collection}
			<squarespace:category collection="directory">
				{.if categories}
				{.repeated section categories}
				<div class="category-filter hover" id="{name}">
					<p onclick="categorize('{name}')">{name}</p>
				</div>
				{.end}
				{.end}
			</squarespace:category>
			{.end}
		</div>
		
    
	</div>
  <p id="filter-text" style=" padding: 15px 25px 0px; font-style: italic;">Showing <span id="category-count"></span></p>
</div>

<div class="flex-start-start flex-wrap directory-wrapper">
	{.repeated section items}
	<script>
		var lat = location.markerLat;
		var long = location.markerLng;
		var coordinate = {lat:{location.markerLat}, lng: {location.markerLng}}
		allCoordinates.push(coordinate);
		

	</script>
	
	<article id="{title}" class="directory-list-item hover {.if customContent.verified} verified-item {.or} unverified-item {.end} box-shadow mymeal-verified {categories} {tags} {@|item-classes}" data-item-id="{id}" >
		<div class="directory-image flex-start-end" {.if customContent.bannerImgUrl}style="background-image:url({customContent.bannerImgUrl})"{.or}style="background-image:url(../assets/basic-bg.png)"{.end} >
		
			<div style="background: rgba(255,255,255,0.5); width: 100%; height: 100%; border-top-left-radius: 6px; border-top-right-radius: 6px;" class="flex-start-end">
		{.if customContent.verified}
			<img onclick="verifiedPopUp(true)" class="verified-badge hover" src="../assets/verified-mymeal.png">
			{.end}
			</div>
		</div>
		<div class="directory-logo-wrapper flex-center-start">
			{.if assetUrl}
			<div class="directory-logo box-shadow" style="background-image: url({assetUrl})"></div>
			{.end}
			{.if location}
			<p class="directory-city hover box-shadow" onclick="window.open('https://www.google.com/maps/search/{location.addressTitle} {location.addressLine1} {location.addressLine2}', '_blank')">
			üìç <span id="address-span"></span></p>
			<script>
			
			function removeAfterSecondComma(str, title) {
				var splitStr = str.split(',');
				
				if (splitStr.length >= 3) {
					splitStr.splice(2);
				}
				
				var modifiedStr = splitStr.join(',');
				document.getElementById(title + '-address-span').textContent = modifiedStr;
				}

			if (`{title}`.includes('&')){
			
			var title = `{title}`.replace(/&amp;/g, "and")
			document.getElementById('address-span').id = title + '-address-span'
			removeAfterSecondComma(`{location.addressLine2}`, title)
		} else {
			document.getElementById('address-span').id = `{title}` + '-address-span'
			removeAfterSecondComma(`{location.addressLine2}`, `{title}`)
		}
</script>
			
			{.end}
		</div>
		{#  Info  }
		<div class="directory-info-container" onclick="window.open('{fullUrl}', '_self')">
      <p class="blog-title" data-content-field="title">{title}</p>
      <div class="flex-center-start flex-wrap" style="margin: 7px 0px;">
        {customContent.priceRank}  
        {.if categories }&nbsp;‚Ä¢&nbsp;
        {.repeated section categories}
        <a class="category-label drop-shadow" href="{collection.fullUrl}?tag={@|url-encode}">{@|url-encode}</a>&nbsp;
        {.end}
        {.if tags }
		<a class="tag-label drop-shadow" id="tagger"></a>&nbsp;	
		<script>

		function checkTags(title, tags){
		
			if (tags.includes(',')){
			var modifiedTags = tags.replace(/,/g, ", ");
			document.getElementById(title + "-tags").innerHTML = "&#x2713;<span>&nbsp;" + modifiedTags + "</span> Free Kitchen"
		} else {
			 document.getElementById(title + "-tags").innerHTML = "&#x2713;<span>&nbsp;" + tags + "</span> Free Kitchen"
		}
		}
			if (`{title}`.includes('&')){
			console.log('yes it does ')
			var title = `{title}`.replace(/&amp;/g, "and")
			document.getElementById('tagger').id = title + '-tags'
			checkTags(title, `{tags}`)
		} else {
			document.getElementById('tagger').id = `{title}` + '-tags'
			checkTags(`{title}`, `{tags}`)
		}
		</script>
        
		
	
						
	
        
        {.end}
      </div>
    </div>
				
		<div class="flex-center-center directory-buttons">
			<button onclick="window.open('{sourceUrl}')" class="large-button styled-button">Allergen Menu</button>
			<button onclick="window.open('{fullUrl}', '_self')" class="large-button styled-button-inverted">Details</button>
		</div>
		
	</article>
	<script>
		var title = `{title}`
		
  		var contentString = document.getElementById(title).innerHTML;
		console.log("content string: " + contentString)
		allContent.push(contentString)
		console.log(allContent)
		</script>
	{.end}
	{.or}
	<!-- no items means no blog posts -->
	<p><em>No blog posts yet.</em></p>
	{.end}
</div>
<!-- pagination -->
{.if pagination}
<nav class="blog-list-pagination">
	<!-- newer page -->
	{.if pagination.prevPage}
	<a href="{pagination.prevPageUrl}">Newer</a>
	{.or}
	<a class="disabled">Newer</a>
	{.end}
	<!-- older page -->
	{.if pagination.nextPage}
	<a href="{pagination.nextPageUrl}">Older</a>
	{.or}
	<a class="disabled">Older</a>
	{.end}
</nav>
{.end}
<script >
	var counter = document.getElementById('category-count')
	  var divs = document.querySelectorAll("article");
	if (divs.length === 1){
	      var restaurantPlural = " restaurant"
	    } else {
	      var restaurantPlural = " restaurants"
	    }
	    counter.textContent = divs.length + restaurantPlural;
	
var resetButton = document.getElementById('reset-categories');

	function reset(){
	  resetButton.style.display = "none"
	  
	  for (var i = 0; i < divs.length; i++) {
	    divs[i].style.display = "block"
	    console.log('reset')
	  }
	  var categoryButtons = document.getElementsByClassName('category-filter')
	  for (var i = 0; i < categoryButtons.length; i++) {
	    categoryButtons[i].classList.remove('active-category');
	
	  }
	  
	  if (divs.length === 1){
	      var restaurantPlural = " restaurant"
	    } else {
	      var restaurantPlural = " restaurants"
	    }
	    counter.textContent = divs.length + restaurantPlural;
	  
	}




var activeCategories = []
	function categorize(name){
		var divs = document.querySelectorAll("article");
		var categoryButton = document.getElementById(name);
		
		
		if (activeCategories.includes(name)){
			console.log("already active")
			 var index = activeCategories.indexOf(name);

				if (index !== -1) {
				activeCategories.splice(index, 1);
				}
				console.log(activeCategories)

			 categoryButton.classList.remove('active-category')
		} else {
			console.log("not active")
			 activeCategories.push(name)
			 console.log(activeCategories)
			 categoryButton.classList.add('active-category')
		}

		if (activeCategories.length === 0){
			document.getElementById('reset-categories').style.display = "none"
		} else {
			document.getElementById('reset-categories').style.display = "block"
		}

		for (var i = 0; i < divs.length; i++) {
				var div = divs[i];
				var hasAllCategories = true;

				for (var j = 0; j < activeCategories.length; j++) {
				if (!div.classList.contains(activeCategories[j])) {
					hasAllCategories = false;
					break;
				}
				}

				if (hasAllCategories) {
				div.style.display = 'block'; 
				
				} else {
				div.style.display = 'none'; 
				}
			}
		count = 0;
		for (var i = 0; i < divs.length; i++) {
			var div = divs[i];
			var display = window.getComputedStyle(div).getPropertyValue('display');

			if (display === 'block') {
			count++;
			}
		}
	    if (count === 1){
	      var restaurantPlural = " restaurant"
	    } else {
	      var restaurantPlural = " restaurants"
	    }
	    counter.textContent = count + restaurantPlural 
	  }
		
	  
	  
	function clickPin(location){
		console.log("clicked a pin with location of ", location)
	}
	
	function initMap() {
	  
	  var map = new google.maps.Map(document.getElementById("map"), {
	    zoom: 9,
		gestureHandling: 'cooperative',
	    center: { lat: 39.7392, lng: -104.9903 },
	    styles: mapStyles,
		
	  });
	  
	  allCoordinates.forEach(function (location, index) {
	          var marker = new google.maps.Marker({
	            position: location,
	            map: map,
	            icon: 'assets/pin.svg'
				
	          });

			  var infoWindow = new google.maps.InfoWindow({
				content: allContent[index]
			});

			  marker.addListener('click', function() {
					
					// Open the InfoWindow when the marker is clicked
					infoWindow.open(map, marker);
					infoWindow.setContent(content)
					// Zoom in to the marker
					map.setZoom(15);
					map.setCenter(marker.getPosition());
					
				});

				infoWindow.addListener('closeclick', function() {
					// Zoom back to the center of the map when the info window is closed
					map.setZoom(9);
					map.setCenter({ lat: 39.7392, lng: -104.9903 });
				});
	        });
			
	  
	      return map;
	  
	}

	
	
	function addPins(allCoordinates){
	  var locations = allCoordinates;
	  locations.forEach(function (location) {
	    
	    var marker = new google.maps.Marker({
	      position: location,
	      map: map,
	    });
	  });
	}
	    
</script>
<script
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBKuNK8g9qwz4O5y1Sll9cff4z28H3sBt0&callback=initMap"
	async
	defer
	></script>

